SELECT '1.0Total settings received from ASPEN' SUMMARY, COUNT(*) COUNT FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS
union
 
 
SELECT '1.1Total ASPEN substation settings (excluding VFI,RCI and AR Equipment types from above)' SUMMARY,
COUNT(*) COUNT FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS WHERE EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
union
 
SELECT '1.2Total ASPEN substation settings matching SAP ' SUMMARY,
COUNT(*) COUNT FROM (
select * from(
 
SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI') ))

union
SELECT '1.3Total ASPEN substation settings not matching SAP ' SUMMARY,
COUNT(*) COUNT FROM (
select * from (
SELECT  DISTINCT NVL(substation,-1),NVL(circuit,-1),NVL(OD43,-1),NVL(key_setting,-1),NVL(raw_setting,-1),NVL(key_identifier,-1), NVL(key_measurement,-1),NVL(key_groupname,-1),NVL(OD43_status,-1)
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
minus

SELECT distinct NVL(substation,-1),NVL(circuit,-1),NVL(OD43,-1),NVL(key_setting,-1),NVL(raw_setting,-1),NVL(key_identifier,-1), NVL(key_measurement,-1),NVL(key_groupname,-1),NVL(OD43_status,-1)
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')))

union
SELECT '1.4Total ASPEN substation settings matching SAP and EMS' SUMMARY,
COUNT(*) COUNT FROM (
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')))

union

SELECT '1.5Total ASPEN substation settings not matching SAP and EMS' SUMMARY,
COUNT(*) COUNT FROM (
select * from (
SELECT  DISTINCT ASPEN.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI') AND 
(NVL(substation,-1),NVL(circuit,-1),NVL(OD43,-1),NVL(key_setting,-1),NVL(raw_setting,-1),NVL(key_identifier,-1), NVL(key_measurement,-1),NVL(key_groupname,-1),NVL(OD43_status,-1))
IN (
SELECT distinct NVL(substation,-1),NVL(circuit,-1),NVL(OD43,-1),NVL(key_setting,-1),NVL(raw_setting,-1),NVL(key_identifier,-1), NVL(key_measurement,-1),NVL(key_groupname,-1),NVL(OD43_status,-1)
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)))

union

SELECT '1.6total ASPEN settings falling out due to Substation Mismatch' SUMMARY,
COUNT(*) COUNT FROM (

SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (--FLOC_ID,
ASPEN.SUBSTATION) NOT IN
  (SELECT 
     -- SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))

union
SELECT '1.7total Remaining data fallouts are due to SAP FLOC ID' SUMMARY,
COUNT(*) COUNT FROM (

select * from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
))   where RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )))
  
union

SELECT '1.8Total unique SAP FLOC ID fallouts from the above count' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))))
  
union

SELECT '1.9TOTAL FLOCids not  PRESENT IN PI and floc ids NOT IN BREAKER table' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT NOT IN(SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '2.0TOTAL FLOCids PRESENT IN PI BUT floc ids NOT IN BREAKER table' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  IN(SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
  
union

SELECT '2.1SAP FLOC ID ending with S' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID    LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ))
  
union
  
SELECT '2.2SAP FLOC ID  with ES-9999' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID  LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ))  
  
union

SELECT '2.3SAP FLOC ID  with OB' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID   LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '2.4Multiple SAP FLOC IDS separated by  &' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '2.5Multiple SAP FLOC IDS separated by  /' SUMMARY,
COUNT(*) COUNT FROM (
select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )

union

SELECT '2.6Multiple SAP FLOC IDS separated by  L1' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID   LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '2.7Multiple SAP FLOC IDS separated by  L2' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID   LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
  
union
  
SELECT '2.8SAP FLOC ID  with CAP' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID  LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '2.9SAP FLOC ID  with PG' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '3.0SAP FLOC ID  with BANK' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '3.1SAP FLOC ID  with BLNK' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%' AND FLOC_ID LIKE '%BLNK%' 
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
  
union

SELECT '3.2SAP FLOC ID  with DECIMAL' SUMMARY,
COUNT(*) COUNT FROM (
select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID  LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
  
union

SELECT '3.3SAP FLOC ID  ENDING with A' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
  
union

SELECT '3.4SAP FLOC ID  ENDING with B' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '3.5SAP FLOC ID  with Z' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
  
union

SELECT '3.6SAP FLOC ID  with ALT GR' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '3.7SAP FLOC ID  ENDING with X' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID   LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '3.8SAP FLOC ID  ENDING with W' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '3.9SAP FLOC ID  ENDING with E' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID  LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '4.0SAP FLOC ID  ENDING with ALL' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID  LIKE '%ALL' AND fLOC_ID  NOT   LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )
  
union

SELECT '4.1SAP FLOC ID   with CB' SUMMARY,
COUNT(*) COUNT FROM (

select * from(
select distinct  FLOC_ID,SUBSTATION,CIRCUIT,OD43,RELAYID,SAP.EQUIPMENT  from (

SELECT distinct aspen.*
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP ON EQUIP.CHAR_VALUE=ASPEN.OD43
                                                                                   JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
                                                                                   JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
                                                                                   WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
                       AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
intersect
SELECT  distinct aspen.*
 FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN where 
ASPEN.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')  

minus(
select * from(
SELECT DISTINCT ASPEN.* FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND (FLOC_ID,ASPEN.SUBSTATION)  IN
  (SELECT
    SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  )
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') 

union 
 
  



SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%N' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
UNION 

SELECT DISTINCT ASPEN.*  FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN

JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP

ON EQUIP.CHAR_VALUE=ASPEN.OD43

JOIN TCGACDS.ODS011_SAP_EQUIP SAP

ON EQUIP.EQUIP_ID=SAP.EQUIPMENT

JOIN TCGACDS.ODS010_SAP_FLOC FLOC

ON FLOC.FLOC_ID   =SAP.FUNCTIONAL_LOCATION

WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'

AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')

AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'

AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'

AND (FLOC_ID,ASPEN.SUBSTATION)  IN

  (SELECT

    SUBSTR(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16),0, LENGTH(SUBSTR(BR.FUNCLOCID, 0, 13) || 'PD' || SUBSTR(BR.FUNCLOCID, 16))-1),

    SUB.NAME

  FROM TCGACDS.GCM_SCIM_BREAKER BR

  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB

  ON BR.GCM_SUBSTATION_ID = SUB.MRID

  AND BR.GCM_JOBID        = SUB.GCM_JOBID

  WHERE BR.GCM_JOBID      IN (select JOBID from TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')

  AND BR.FUNCLOCID       IS NOT NULL and br.FUNCLOCID like '%S' 

  )

AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER'))
)) asp JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=asp.OD43 
JOIN TCGACDS.ODS011_SAP_EQUIP SAP ON EQUIP.EQUIP_ID=SAP.EQUIPMENT 
JOIN TCGACDS.ODS010_SAP_FLOC FLOC ON FLOC.FLOC_ID=SAP.FUNCTIONAL_LOCATION 
  WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER' AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS') AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%' AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%' 
AND asp.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER') and asp.EQUIPMENT_TYPE NOT IN('AR','VFI','RCI')
AND FLOC_ID NOT LIKE '%ES-9999%' AND  FLOC_ID NOT  LIKE '%OB%' AND   FLOC_ID  NOT LIKE '%&%' AND FLOC_ID NOT  LIKE '%/%' AND FLOC_ID  NOT  LIKE '%L1' AND
FLOC_ID  NOT  LIKE '%L2' AND FLOC_ID   NOT LIKE '%CAP%' AND FLOC_ID NOT   LIKE '%PG%'  AND   FLOC_ID  NOT  LIKE '%S' AND FLOC_ID    NOT LIKE '%BANK%'
AND FLOC_ID     NOT LIKE '%.%' AND FLOC_ID NOT LIKE '%A' AND  FLOC_ID NOT  LIKE '%B' AND  FLOC_ID not  LIKE '%Z%'
and fLOC_ID  NOT LIKE '%ALT GR%' AND  fLOC_ID NOT  LIKE '%X' AND  fLOC_ID   NOT LIKE '%W' AND  fLOC_ID NOT   LIKE '%E' AND
fLOC_ID    NOT LIKE '%ALL' AND fLOC_ID  LIKE '%CB%'
 AND RELAYID NOT IN (
  SELECT distinct  ASPEN.RELAYID
FROM TCGACDS.GCM_ASPEN_RELAY_SETTINGS ASPEN
JOIN TCGACDS.ODS013_EQUIP_CHARS EQUIP
ON TCGACDS.EQUIP.CHAR_VALUE=ASPEN.OD43
JOIN TCGACDS.ODS011_SAP_EQUIP SAP
ON TCGACDS.EQUIP.EQUIP_ID=SAP.EQUIPMENT
JOIN TCGACDS.ODS010_SAP_FLOC FLOC
ON FLOC.FLOC_ID      =SAP.FUNCTIONAL_LOCATION
WHERE EQUIP.CHAR_NAME='E_OD43_NUMBER'
AND SAP.OBJECT_TYPE IN ('ES_R_EM','ES_R_M','ES_R_SS')
AND SAP.SYSTEM_STATUS NOT LIKE '%INAC%'
AND SAP.SYSTEM_STATUS NOT LIKE '%DLFL%'
AND ASPEN.EQUIPMENT_TYPE IN ('LINE', 'TRANSFORMER', 'BUS TIE', 'CAPACITOR', 'BUS PARALLEL BREAKER')
AND (ASPEN.SUBSTATION
) NOT IN
  (SELECT 
    SUB.NAME
  FROM TCGACDS.GCM_SCIM_BREAKER BR
  JOIN TCGACDS.GCM_SCIM_SUBSTATION SUB
  ON BR.GCM_SUBSTATION_ID = SUB.MRID
  AND BR.GCM_JOBID        = SUB.GCM_JOBID
  WHERE BR.GCM_JOBID      = (SELECT JOBID FROM TCGACDS.GCM_PROCESS_STATUS WHERE ACTIVEJOBID='Y')
  AND BR.FUNCLOCID       IS NOT NULL
  ))AND EQUIPMENT  NOT IN (SELECT
   PROTECTIONEQUIPMENTID
  
  FROM TCGACDS.GCM_SCIM_PROTECTIONEQUIPMENT WHERE PROTECTIONEQUIPMENTID IS NOT NULL )  ) )